```markdown
# User Management Script

Bash-скрипт для массового создания пользователей и групп в Linux с интерактивным меню.

## Возможности

- **Массовое создание** пользователей из файла
- **Интерактивное меню** для ручного управления
- **Автоматическое создание групп**
- **Цветной вывод** и подробное логирование
- **Обработка ошибок** и проверка входных данных
- **Безопасный режим** выполнения

## Требования

- Linux-система
- Права root для выполнения

## Быстрый старт

### Установка

```bash
git clone https://github.com/your-username/user-manage-script.git
cd user-manage-script
chmod +x user_manage.sh
```

### Базовое использование

```bash
sudo ./user_manage.sh
```

## Использование

### 1. Массовое создание пользователей из файла

Создайте файл `/var/users`:

```text
# Формат: username groupname
alice developers
bob developers
charlie admins
diana support
```

Запустите скрипт:
```bash
sudo ./user_manage.sh
```

### 2. Интерактивный режим

Если файл `/var/users` не существует, скрипт запустит интерактивное меню:

```
=== Меню управления пользователями ===
1) Добавить пользователя
2) Показать всех пользователей  
3) Выход
Выберите опцию (1-3):
```

## Формат файла пользователей

Файл `/var/users` должен содержать пары "пользователь группа" по одной на строку:

```text
username1 group1
username2 group2
username3 group3
```

- Пустые строки и строки, начинающиеся с `#`, игнорируются
- Поддерживаются пробелы и табуляции как разделители

## Функции скрипта

### Основные функции:
-  Создание пользователей и групп
-  Проверка существующих записей
-  Автоматическое создание домашних директорий
-  Подробное логирование операций

### Безопасность:
-  Проверка прав root
-  Валидация входных данных
-  Обработка сигналов (Ctrl+C)
-  Strict mode (`set -euo pipefail`)

### Логирование:
-  Все операции записываются в `/var/log/user_manage.log`
-  Timestamp для каждой операции
-  Статистика успешных/неудачных операций

## Примеры использования

### Пример 1: Создание тестовых пользователей

```bash
# Создаем файл с тестовыми данными
sudo tee /var/users << EOF
testuser1 testgroup
testuser2 testgroup
adminuser admins
EOF

# Запускаем скрипт
sudo ./user_manage.sh
```

### Пример 2: Интерактивное создание

```bash
sudo ./user_manage.sh

# В меню выбираем:
# 1 → "Добавить пользователя"
# Вводим: john → developers
# Пользователь создан!
```

### Пример 3: Проверка результатов

```bash
# Проверить созданных пользователей
id testuser1
id testuser2

# Посмотреть логи
sudo tail -f /var/log/user_manage.log
```

## Настройка

### Изменение путей по умолчанию

Отредактируйте переменные в скрипте:

```bash
# Конфигурация
readonly USER_FILE="/var/users"          # Файл с пользователями
readonly LOG_FILE="/var/log/user_manage.log"  # Файл логов
```

### Настройка оболочки пользователей

В функции `create_user` измените параметр `-s` в команде `useradd`:

```bash
useradd -m -g "$groupname" -s "/bin/bash" "$username"
```

## Логирование

Скрипт ведет детальный лог всех операций:

```bash
# Просмотр логов
sudo cat /var/log/user_manage.log

# Мониторинг в реальном времени
sudo tail -f /var/log/user_manage.log
```

**Пример записи в логе:**
```
2024-01-15 10:30:45 - Пользователь alice создан в группе developers
2024-01-15 10:30:46 - Группа admins создана
2024-01-15 10:30:46 - Пользователь charlie создан в группе admins
```

## Устранение неполадок

### Частые проблемы:

**Ошибка прав доступа:**
```
Ошибка: Этот скрипт должен запускаться от root.
```
*Решение:* Запустите скрипт с `sudo`

**Файл пользователей не найден:**
```
Файл /var/users не найден или пуст
```
*Решение:* Создайте файл или используйте интерактивный режим

**Пользователь уже существует:**
```
Пользователь john уже существует
```
*Решение:* Скрипт пропускает существующих пользователей